\documentclass{beamer}
\usepackage[utf8]{inputenc}
\usepackage{mathtools}
\usepackage{xcolor}
\usepackage[linesnumbered,ruled,vlined]{algorithm2e}
\newcommand\mycommfont[1]{\footnotesize\ttfamily\textcolor{blue}{#1}}
\SetCommentSty{mycommfont}


\usetheme{Warsaw}
\useoutertheme{infolines}
\usepackage{tikz}
\newcommand\RBox[1]{%
  \tikz\node[draw,rounded corners,align=center,] {#1};%
}  
\author[Elm S. \& Karthe T. \& Golebiewski D. \& Schröder M.E.]
{%
   \texorpdfstring{
        \begin{columns}
            \column{.45\linewidth}
            \centering
            \RBox{Elm S.\\
            \href{mailto:subhamsoni0049@pec.edu}{subhamsoni0049@pec.edu}}
            \column{.45\linewidth}
            \centering
            \RBox{Karthe T.\\
            \href{mailto:subhamsoni0049@pec.edu}{subhamsoni0049@pec.edu}}
        \end{columns}
        \vspace{0.5cm}
        \begin{columns}
            \column{.45\linewidth}
            \centering
            \RBox{Golebiewski D.\\
            \href{mailto:subhamsoni0049@pec.edu}{subhamsoni0049@pec.edu}}
            \column{.45\linewidth}
            \centering
            \RBox{Schröder M.E.\\
            \href{mailto:malte.schroeder@tuhh.de}{malte.schroeder@tuhh.de}}
        \end{columns}
        \vspace{-0.3cm}
        \begin{columns}
          \column{0.3\linewidth}
          \raggedleft
            \vspace{-4.8cm}
            \column{0.6\linewidth}
            \raggedright
            Institute of Medical Technology\\[1.1ex]
            TUHH
            \vspace{-4.8cm}
        \end{columns}
   }
   {John Doe \& Jane Doe}
}
\title{Treatment planning tool for HDR Brachytherapy}
\begin{document}
\begin{frame}
\titlepage
\end{frame}
\frame{\tableofcontents}

\section{Algorithms}
\subsection{Genetic Algorithm}
\subsubsection{Individual}

 \begin{frame}
 \frametitle{Individual}
 The dwelltimes of the seeds are encoded in the individuals. Equation \eqref{eq:individual} shows one individual for $n  $ Seeds.
 \begin{equation}
 \label{eq:individual}
 Individual \ \ i := \begin{pmatrix}
 t_{0} \\ \vdots \\ t_{n-1} 	
\end{pmatrix}   
 \end{equation}
 \end{frame}
 
\subsubsection{Population}
 \begin{frame}
 \frametitle{Population}
 A population consists of a certain number of individuals given by the constant $ k $.
 \begin{equation}
 \label{eq:population}
 Population \ \ p := \begin{pmatrix}
 i_{0} \\ \vdots \\ i_{k-1} 	
\end{pmatrix}   
 \end{equation}
 \end{frame}
 
 \subsubsection{Fitness-Function}
 \begin{frame}
 \frametitle{Fitness-Function}
 The Fitness-Function calculates the squared differnce between the goaldose and the current dose within the whole body.
 \begin{equation}
 f(individual) = \sum_{body}(GD-CD)^2
 \end{equation}
 For further adjustment and prioritisation the Fitness-Function is extended by an weighting factor, which holds a specifig weight for any bodytype (tumor, liver, spine,...).
 \begin{equation}
 f(individual) = \sum_{body}w_{bodytype}(GD-CD)^2
 \end{equation}
 \end{frame}
 
 
 \subsubsection{Optimisation}
 \begin{frame}
 \frametitle{Optimisation}
 \IncMargin{1em}
 \begin{algorithm}[H]
 $temp=0$\;
 \For{x=0; x $\textless$ body.xDim; x++}{
 	\For{y=0; y $\textless$ body.yDim; y++}{
 		\For{z=0; z $\textless$ body.zDim; z++}{
 			\For{j=0; j $\textless$ numberOfSeeds; j++} {
				 	$temp\ \ = temp+  w_{bodytype}(GD-CD)^2$\;		
 			}
  		}
  	}
  }
 $fitnessvalue = \sqrt{temp}$\;
 \Return{fitnessvalue}\;
 \caption{Calculation of the fitnessvalue}
 \end{algorithm}
 \DecMargin{1em}
 \color{red}This causes a very high runtime...
 \end{frame}
 
 \begin{frame}
 \frametitle{Optimisation Strategies}
 Solutions to reduce the runtime:
 \begin{enumerate}
 \item Multithreading
 \item Evaluation only in a specific region around the tumor
 \item "Jump" in the for loop
 \end{enumerate}
 
 \end{frame}
 
 \begin{frame}
 \frametitle{Optimised Algorithm}
 \IncMargin{1em}
 \begin{algorithm}[H]
 \SetKwFunction{cb}{CalculateBounds}
 \SetKwFunction{thread}{ThreadedFitnessFunction}

 \emph{x-roi,y-roi,z-roi $\leftarrow$} \cb{body}  \;
 \For{x-roi}{
 	\thread{x,y-roi,z-roi}
 }
 \caption{Multithreaded Fitness-Function}
 \end{algorithm}
 \DecMargin{1em}
 
 \IncMargin{1em}
 \begin{algorithm}[H]


 \For{y=y-roi.min; y $\textless$ y-rio.max; y$\leftarrow$y+Scalefactor}{
 		\For{z=z-roi.min; z $\textless$ z-rio.max; z$\leftarrow$z+Scalefactor}{
 			\For{j=0; j $\textless$ numberOfSeeds; j++} {
				 	$temp\ \ = temp+  w_{bodytype}(GD-CD)^2$\;		
 			}
  		}
  	}
 \caption{Optimised Fitness-Function}
 \end{algorithm}
 \DecMargin{1em}
 
\end{frame}
 
\begin{frame}

\subsubsection{Elitism}
\frametitle{Elitism}
The idea of elitism is to take in every iteration the best individuals into the next iteration without any cross-over or mutation. 
\end{frame}
\subsubsection{Stop-Criterion}
\begin{frame}
\frametitle{Stop-Criterion}
The Stop-Criterion for the genetic algorithm is implemented as follows:
\IncMargin{1em}
\begin{algorithm}[H]
\SetKwFunction{iter}{GeneticAlgIteration}
$bestIndividual \leftarrow \infty $ \tcp*{FitnessValue of the best individual}  
$bestIndividualOld,currentIndividual \leftarrow 0$\;
$stop \leftarrow false$\;
$counter \leftarrow 0$\;
\While{! stop} {
 \tcc{Returns the best fitness value from the current iteration}
	$currentIndividual \leftarrow $\iter{}\;
	\If{$currentIndividual \ \   \textless \ \ bestIndividual$} {
	
		$ bestIndividual \ \   \leftarrow \ \ currentIndividual $\;
	
	}
	\If{$\left|bestIndividualOld-bestIndividual \right| \ \ \textless \ \ 1$} {
		\emph{counter++}
	} 
	\If{$counter \geq 5$} {
		$done \leftarrow true$
	}  
	
	
	
	
	}
	 

\caption{Stop-Criterion}
\end{algorithm}\DecMargin{1em}

\end{frame}

\subsubsection{Parameter}
\begin{frame}
\frametitle{Parameter Overview}
	\begin{itemize}
	\item Optimisation Paramter:
		\begin{itemize}
		\item Treatment-Range
		\item Scalefactor
		\end{itemize}
	\item Genetic Algorithm Parameter:
		\begin{itemize}
		\item Population size $k$
		\item Weighting facors $w_{bodytype}$
		\item Mutation Probability $P_{mutation}$
		\item Crossover Probability $P_{crossover}$
		\item Number of elite individuals
		\end{itemize}
	\end{itemize}
 
 
\end{frame}

\begin{frame}
\frametitle{Parameter Overview}
\textcolor{red}{parameter with influence on runtime} \\
 \textcolor{blue}{parameter with impact on optimisation quality}  
	\begin{itemize}
	\item Optimisation Paramter:
		\begin{itemize}
		\item \textcolor{red}{Treatment}\textcolor{blue}{-Range}
		\item \textcolor{red}{Scale}\textcolor{blue}{factor}
		\end{itemize}
	\item Genetic Algorithm Parameter:
		\begin{itemize}
		\item \textcolor{red}{Population} \textcolor{blue}{size $k$}
		\item \textcolor{blue}{Weighting facors $w_{bodytype}$}
		\item \textcolor{blue}{Mutation Probability $P_{mutation}$}
		\item \textcolor{blue}{Crossover Probability $P_{crossover}$}
		\item \textcolor{blue}{Number of elite individuals}
		\end{itemize}
	\end{itemize}
 
 
\end{frame}

\begin{frame}
\frametitle{Runtime}

\begin{itemize}
\item Multithreading \textcolor{red}{off}
\item $k = 12$
\item $Elitism = 2$
\item $Scalefactor = 1$
\item $Treatmentrange = 10 \ cm$
\end{itemize}

 \textbf{$\Rightarrow \ \sim $20h Runtime} 
 


\end{frame}

\begin{frame}

Runtime with and without optimisation\footnote{Intel\textregistered  Core i5-3570K CPU @ 4x3.40Ghz}
\begin{columns}[T] % align columns
\begin{column}{.48\textwidth}
\begin{itemize}
\item Multithreading \textcolor{red}{off}
\item $k = 12$
\item $Elitism = 2$
\item $Scalefactor = 1$
\item $Treatmentrange = 10 \ cm$
\end{itemize}

 \textbf{$\Rightarrow \ \sim $20h Runtime}
\end{column}%
\hfill%

\begin{column}{.48\textwidth}
\begin{itemize}
\item Multithreading \textcolor{green}{on}
\item $k = 12$
\item $Elitism = 2$
\item $Scalefactor = 5$
\item $Treatmentrange = 8 \ cm$
\end{itemize}

 \textbf{$\Rightarrow \ \sim $10min Runtime}
\end{column}%
\end{columns}
\end{frame}
 
 
 
\end{document}